name: 'Deploy to Oracle'
on:
  push:
    branches:
      - 'replace-nx-with-turborepo'

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    steps:
      - name: 'Install Oracle CLI'
        run: |
          curl -L -O https://raw.githubusercontent.com/oracle/oci-cli/master/scripts/install/install.sh
          chmod +x install.sh
          ./install.sh --accept-all-defaults
          exec -l $SHELL
     
      # - name: 'Check existing instance'
        # run : |
          # echo "oci compute instance list \
          #   --lifecycle-state RUNNING \
          #   --compartment-id ${{secrets.VM_COMPARTMENT_ID}} \
          #   --display-name memory-snap \
          #   --raw-output \
          # "

      - name: 'Wait for SSH'
        run: |
          while ! nc -w5 -z ${{ secrets.OCI_INSTANCE_PUBLIC_IP }} 22; do
                  sleep 5
                  echo "SSH not available..."
          done; echo "SSH ready!"
  

